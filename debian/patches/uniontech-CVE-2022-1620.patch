Index: vim/src/buffer.c
===================================================================
--- vim.orig/src/buffer.c
+++ vim/src/buffer.c
@@ -2888,7 +2888,7 @@ fname_match(
 	rmp->rm_ic = p_fic || ignore_case;
 	if (vim_regexec(rmp, name, (colnr_T)0))
 	    match = name;
-	else
+	else if (rmp->regprog != NULL)
 	{
 	    // Replace $(HOME) with '~' and try matching again.
 	    p = home_replace_save(NULL, name);
Index: vim/src/testdir/test_buffer.vim
===================================================================
--- vim.orig/src/testdir/test_buffer.vim
+++ vim/src/testdir/test_buffer.vim
@@ -430,4 +430,11 @@ func Test_buffer_maxmem()
   set maxmem& maxmemtot&
 endfunc
 
+" this was using a NULL pointer after failing to use the pattern
+func Test_buf_pattern_invalid()
+  vsplit 0000000
+  silent! buf [0--]\&\zs*\zs*e
+  bwipe!
+endfunc
+
 " vim: shiftwidth=2 sts=2 expandtab
